<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dz.factory.production.mapper.ProductionListMapper">
	<select id="getProductionList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select production.*, d.*, i.item_name, s.storage_name, l.location_name, p.partner_name, emp.emp_name, c.common_name as team
	from production
		left join production_detail d on production.production_code = d.production_code
        left join item i on d.item_code=i.item_code
        left join storage s on d.storage_code=s.storage_code
        left join detail_location l on l.location_code=d.location_code
        left join partner p on p.partner_code=d.partner_code
        left join emp on emp.emp_id=d.emp_id
        left join code_common c on c.management_code='TEAM' and c.common_code=d.team_code
		<where>
			<foreach collection="filterList" index="key" item="value" separator="and">
				<choose>
					<when test= "key.equals('date')">
						date(production_date)='${value}'
					</when>
					<when test= "key.equals('description')">
						 d.description LIKE CONCAT('%', '${value}', '%')
					</when>					
					<otherwise>
						${key}='${value}'
					</otherwise>				
				</choose>
			</foreach>
		</where>
	</select>
	
	<select id="getComponentList" parameterType="java.util.ArrayList" resultType="java.util.HashMap">
		<foreach collection="productionCode" item="code">
			select c.*, item.item_name, s.storage_name, l.location_name
			from production_detail_component c
			left join item on c.item_code= item.item_code
			left join storage s on c.storage_code=s.storage_code
			left join detail_location l on c.location_code=l.location_code
			where production_code=#{code};
		</foreach>
	</select>
	
	
	<update id="updateProduction" parameterType="production">
		alter table production 
	</update>
	<update id="updateDetail">
		
	</update>
	<update id="updateComponent">
	
	</update>
	<update id="deleteProduction">
	
	</update>
	
	
</mapper>